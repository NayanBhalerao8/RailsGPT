<div class="blog-show-container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
  <% if notice.present? %>
    <div class="notice" style="background-color: #d4edda; color: #155724; padding: 12px 20px; border-radius: 6px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
      <%= notice %>
    </div>
  <% end %>
  
  <!-- Blog Header -->
  <header style="margin-bottom: 30px;">
    <h1 style="font-size: 2.5rem; color: #333; margin-bottom: 10px;"><%= @blog_post.title %></h1>
    <div class="blog-meta" style="display: flex; align-items: center; color: #777; font-size: 0.9rem;">
      <span style="display: flex; align-items: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 4px;">
          <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
          <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
        </svg>
        <%= @blog_post.created_at.strftime("%B %d, %Y") %>
      </span>
    </div>
  </header>
  
  <div class="blog-content-container" style="display: flex; flex-direction: column; gap: 30px;">
    <!-- Featured Image -->
    <% if @blog_post&.image&.attached? %>
      <div class="blog-featured-image" style="width: 100%; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <%= image_tag @blog_post.image, style: "width: 100%; display: block;" %>
      </div>
    <% end %>
    
    <!-- Tabs for Content View Options -->
    <div class="view-tabs" style="display: flex; border-bottom: 1px solid #e1e4e8;">
      <button id="tab-rendered" class="view-tab active" style="padding: 10px 16px; background: none; border: none; border-bottom: 2px solid #2196F3; font-weight: 500; color: #2196F3; cursor: pointer;">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="vertical-align: text-bottom; margin-right: 5px;">
          <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/>
        </svg>
        Rendered View
      </button>
      <button id="tab-source" class="view-tab" style="padding: 10px 16px; background: none; border: none; border-bottom: 2px solid transparent; font-weight: 500; color: #666; cursor: pointer;">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="vertical-align: text-bottom; margin-right: 5px;">
          <path d="M10.478 1.647a.5.5 0 1 0-.956-.294l-4 13a.5.5 0 0 0 .956.294l4-13zM4.854 4.146a.5.5 0 0 1 0 .708L1.707 8l3.147 3.146a.5.5 0 0 1-.708.708l-3.5-3.5a.5.5 0 0 1 0-.708l3.5-3.5a.5.5 0 0 1 .708 0zm6.292 0a.5.5 0 0 0 0 .708L14.293 8l-3.147 3.146a.5.5 0 0 0 .708.708l3.5-3.5a.5.5 0 0 0 0-.708l-3.5-3.5a.5.5 0 0 0-.708 0z"/>
        </svg>
        Source View
      </button>
    </div>
    
    <!-- Content Views -->
    <div id="rendered-view" class="content-view" style="background-color: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); padding: 30px;">
      <!-- This div will be populated with rendered markdown -->
      <div id="markdown-content" class="markdown-content"></div>
    </div>
    
    <div id="source-view" class="content-view" style="display: none; background-color: #f6f8fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); padding: 20px; font-family: monospace; white-space: pre-wrap; line-height: 1.5;">
      <%= @blog_post.content %>
    </div>
    
    <!-- Hidden Content for Markdown Rendering -->
    <div id="content-source" style="display: none;"><%= @blog_post.content %></div>
  </div>
  
  <!-- Actions -->
  <div class="blog-actions" style="margin-top: 40px; display: flex; gap: 10px; border-top: 1px solid #e1e4e8; padding-top: 20px;">
    <%= link_to blog_posts_path, style: "display: inline-flex; align-items: center; padding: 8px 16px; text-decoration: none; color: #666; border: 1px solid #ddd; border-radius: 4px;" do %>
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 6px;">
        <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
      </svg>
      Back to Blog Posts
    <% end %>
    
    <%= link_to edit_blog_post_path(@blog_post), style: "display: inline-flex; align-items: center; padding: 8px 16px; text-decoration: none; color: white; background-color: #2196F3; border-radius: 4px;" do %>
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 6px;">
        <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
      </svg>
      Edit Post
    <% end %>
    
    <%= button_to @blog_post, method: :delete, style: "display: inline-flex; align-items: center; padding: 8px 16px; background-color: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;" do %>
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 6px;">
        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
        <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
      </svg>
      Delete Post
    <% end %>
  </div>
</div>

<!-- JavaScript for Markdown Rendering -->
<script>
  function initMarkdownViewer() {
    console.log('Initializing markdown viewer');
    // Load markdown-it if not already loaded
    if (!window.markdownit) {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js';
      script.onload = renderMarkdown;
      document.head.appendChild(script);
    } else {
      renderMarkdown();
    }
    
    // Setup tab switching functionality
    setupTabs();
  }
  
  function setupTabs() {
    const renderedTab = document.getElementById('tab-rendered');
    const sourceTab = document.getElementById('tab-source');
    
    if (renderedTab && sourceTab) {
      // Remove existing event listeners if any (to prevent duplicates)
      renderedTab.removeEventListener('click', function() { switchTab('rendered'); });
      sourceTab.removeEventListener('click', function() { switchTab('source'); });
      
      // Add new event listeners
      renderedTab.addEventListener('click', function() {
        switchTab('rendered');
      });
      
      sourceTab.addEventListener('click', function() {
        switchTab('source');
      });
    }
  }
  
  function switchTab(tabId) {
    // Update tab styles
    document.querySelectorAll('.view-tab').forEach(tab => {
      tab.classList.remove('active');
      tab.style.borderBottomColor = 'transparent';
      tab.style.color = '#666';
    });
    
    document.getElementById('tab-' + tabId).classList.add('active');
    document.getElementById('tab-' + tabId).style.borderBottomColor = '#2196F3';
    document.getElementById('tab-' + tabId).style.color = '#2196F3';
    
    // Show/hide content views
    document.querySelectorAll('.content-view').forEach(view => {
      view.style.display = 'none';
    });
    
    document.getElementById(tabId + '-view').style.display = 'block';
  }
  
  // Initialize on both DOMContentLoaded and Turbo navigation
  document.addEventListener('DOMContentLoaded', initMarkdownViewer);
  document.addEventListener('turbo:load', initMarkdownViewer);
  document.addEventListener('turbo:render', initMarkdownViewer);
    
  function renderMarkdown() {
    console.log('Rendering markdown content');
    if (!window.markdownit) {
      console.error('markdown-it library not loaded');
      return;
    }
    
    const contentSource = document.getElementById('content-source');
    const markdownContent = document.getElementById('markdown-content');
    
    if (!contentSource || !markdownContent) {
      console.error('Required elements not found', { 
        contentSource: contentSource ? 'found' : 'not found', 
        markdownContent: markdownContent ? 'found' : 'not found' 
      });
      return;
    }
    
    try {
      const md = window.markdownit({
        html: true,
        linkify: true,
        typographer: true
      });
      
      const content = contentSource.textContent;
      const renderedHTML = md.render(content);
      markdownContent.innerHTML = renderedHTML;
      
      // Add styling for markdown content if not already added
      if (!document.getElementById('markdown-content-styles')) {
        const style = document.createElement('style');
        style.id = 'markdown-content-styles';
        style.textContent = `
          .markdown-content h1, .markdown-content h2 { border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; margin-top: 24px; margin-bottom: 16px; }
          .markdown-content h1 { font-size: 2em; }
          .markdown-content h2 { font-size: 1.5em; }
          .markdown-content h3 { font-size: 1.25em; margin-top: 24px; margin-bottom: 16px; }
          .markdown-content h4 { font-size: 1em; margin-top: 24px; margin-bottom: 16px; }
          .markdown-content p { margin-bottom: 16px; line-height: 1.6; }
          .markdown-content pre { background-color: #f6f8fa; padding: 16px; border-radius: 6px; overflow: auto; margin-bottom: 16px; }
          .markdown-content code { background-color: rgba(27,31,35,0.05); padding: 0.2em 0.4em; border-radius: 3px; font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace; }
          .markdown-content pre code { background-color: transparent; padding: 0; }
          .markdown-content blockquote { padding: 0 1em; color: #6a737d; border-left: 0.25em solid #dfe2e5; margin-bottom: 16px; }
          .markdown-content img { max-width: 100%; margin-bottom: 16px; }
          .markdown-content ul, .markdown-content ol { padding-left: 2em; margin-bottom: 16px; }
          .markdown-content li { margin-bottom: 0.25em; }
          .markdown-content table { border-collapse: collapse; width: 100%; overflow: auto; margin-bottom: 16px; }
          .markdown-content table th, .markdown-content table td { border: 1px solid #dfe2e5; padding: 6px 13px; }
          .markdown-content table tr { background-color: #fff; border-top: 1px solid #c6cbd1; }
          .markdown-content table tr:nth-child(2n) { background-color: #f6f8fa; }
          .markdown-content hr { height: 0.25em; padding: 0; margin: 24px 0; background-color: #e1e4e8; border: 0; }
        `;
        document.head.appendChild(style);
      }
      
      console.log('Markdown rendered successfully');
    } catch (error) {
      console.error('Error rendering markdown:', error);
    }
  }
</script>
